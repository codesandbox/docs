---
title: Memory Snapshots
description: Learn how memory snapshots work in the CodeSandbox SDK.
---

# Memory Snapshots

When you hibernate a sandbox, we keep a memory snapshot of the underlying Firecracker VM. When you start that sandbox, or if any network request is made to the sandbox, we'll restore the memory snapshot and continue from where you left off.

## Manually Creating a Memory Snapshot

You can manually create a memory snapshot by calling `sandbox.hibernate()`:

```ts
import { CodeSandbox } from '@codesandbox/sdk'
const sdk = new CodeSandbox();

const sandbox = await sdk.sandbox.create();

// Do work

await sandbox.hibernate();
```

Creating a memory snapshot can take between 3-10 seconds. Resuming from a memory snapshot takes between 0.5-2 seconds.

## Cloning a Sandbox

Because we can snapshot a sandbox, we can also clone it! For example, you can clone a sandbox to create a new sandbox running the same server.

```ts
import { CodeSandbox } from '@codesandbox/sdk'
const sdk = new CodeSandbox();

const sandbox = await sdk.sandbox.create();

// Run anything on the sandbox
await sandbox.shells.run('echo test > test.txt');

const sandbox2 = await sandbox.fork();

// Now we have two sandboxes that have the same fs & memory state!
```

You could use this to add support for checkpoint/restore functionality, or A/B test different agent iterations. At CodeSandbox we use this to enable forking of sandboxes. Someone can share a template, and someone else can click "Fork" to create a new sandbox based on the same state.

## Learn More

We have written a couple blog posts about how memory snapshots work under the hood:

- [How we clone a running VM in 2 seconds](https://codesandbox.io/blog/how-we-clone-a-running-vm-in-2-seconds)
- [Cloning microVMs by sharing memory through userfaultfd](https://codesandbox.io/blog/cloning-microvms-using-userfaultfd)
- [How we scale our microVM infrastructure using low-latency memory decompression](https://codesandbox.io/blog/how-we-scale-our-microvm-infrastructure-using-low-latency-memory-decompression)
